{% extends "base.html" %}

{% block title %}Bluesky Custom Feed - Posts with Images from Followed Users{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4 controls-bar">
            <div>
                <h1 class="h2">
                    <i class="fas fa-images text-primary"></i> 
                    Posts with Images from Users You Follow
                </h1>
                <div class="d-flex align-items-center mt-2">
                    <span id="status-indicator" class="badge bg-secondary me-2 d-flex align-items-center">
                        <i class="fas fa-circle me-1"></i> Checking connection...
                    </span>
                    <small class="text-muted">Custom Feed ‚Ä¢ Followed Users Only ‚Ä¢ Includes Reposts from Followed Users</small>
                </div>
            </div>
            <div class="d-flex align-items-center flex-wrap gap-2 justify-content-end w-100 w-md-auto">
                <button class="btn btn-primary" id="refresh-btn" onclick="loadPosts()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
                <button class="btn btn-outline-primary ms-2" id="fetch-more-btn" title="Fetch 9 more (up to 18)">
                    <i class="fas fa-plus"></i> Fetch more
                </button>
                <button class="btn btn-outline-secondary ms-2" id="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode (Ctrl+D)">
                    <i class="fas fa-moon" id="theme-icon"></i>
                </button>
                <button class="btn btn-outline-info ms-2" onclick="showKeyboardShortcuts()" title="Keyboard shortcuts (Ctrl+?)">
                    <i class="fas fa-keyboard"></i>
                </button>
                <div class="btn-group ms-2" role="group">
                    <input type="radio" class="btn-check" name="postCount" id="count6" value="6">
                    <label class="btn btn-outline-secondary" for="count6">6</label>
                    
                    <input type="radio" class="btn-check" name="postCount" id="count9" value="9" checked>
                    <label class="btn btn-outline-secondary" for="count9">9</label>
                    
                    <input type="radio" class="btn-check" name="postCount" id="count12" value="12">
                    <label class="btn btn-outline-secondary" for="count12">12</label>
                </div>
                <div class="btn-group ms-2" role="group">
                    <input type="radio" class="btn-check" name="maxPerUser" id="max1" value="1" checked>
                    <label class="btn btn-outline-info" for="max1">1/user</label>
                    
                    <input type="radio" class="btn-check" name="maxPerUser" id="max2" value="2">
                    <label class="btn btn-outline-info" for="max2">2/user</label>
                    
                    <input type="radio" class="btn-check" name="maxPerUser" id="maxUnlimited" value="10">
                    <label class="btn btn-outline-info" for="maxUnlimited">‚àû</label>
                </div>
                <button class="btn btn-outline-warning ms-2 no-shrink" onclick="showThemeConfig()" title="Configure AI reply themes">
                    <i class="fas fa-palette"></i> AI Themes
                </button>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loading" class="text-center py-5" style="display: none;">
            <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                <span class="visually-hidden">Loading...</span>
            </div>
            <div class="progress-text">
                <h4 class="text-primary mb-2">Fetching Posts from Your Custom Feed</h4>
                <p class="text-muted">Searching through posts from users you follow for images (includes reposts from followed users)...</p>
                <div class="progress mt-3" style="height: 8px;">
                    <div class="progress-bar progress-bar-striped progress-bar-animated bg-primary" 
                         role="progressbar" 
                         style="width: 0%" 
                         aria-valuenow="0" 
                         aria-valuemin="0" 
                         aria-valuemax="100">
                    </div>
                </div>
            </div>
        </div>

        <!-- Success Alert -->
        <div id="success-alert" class="alert alert-success" style="display: none;" role="alert">
            <i class="fas fa-check-circle"></i>
            <span id="success-message"></span>
        </div>

        <!-- Error Alert -->
        <div id="error-alert" class="alert alert-danger" style="display: none;" role="alert">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="error-message"></span>
        </div>

        <!-- Warning Alert -->
        <div id="warning-alert" class="alert alert-warning" style="display: none;" role="alert">
            <i class="fas fa-exclamation-circle"></i>
            <span id="warning-message"></span>
        </div>

        <!-- Posts Container -->
        <div id="posts-container">
            <!-- Posts will be loaded here -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="text-center py-5" style="display: none;">
            <i class="fas fa-images fa-3x text-muted mb-3"></i>
            <h3 class="text-muted">No posts with images found</h3>
            <p class="text-muted">The app searches through posts from users you follow for images (includes reposts from followed users). Try refreshing or check your Bluesky connection.</p>
        </div>
    </div>
</div>

<!-- Theme Configuration Modal -->
<div class="modal fade" id="themeConfigModal" tabindex="-1" aria-labelledby="themeConfigModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="themeConfigModalLabel">
                    <i class="fas fa-robot me-2"></i>AI Persona Configuration
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-12">
                        <h6 class="mb-3">ü§ñ AI Persona</h6>
                        <div class="mb-3">
                            <textarea class="form-control" id="personaTextarea" rows="3" placeholder="Describe the AI's personality, interests, and expertise..."></textarea>
                            <div class="form-text">Define who the AI is and what they care about. This shapes their perspective and knowledge base.</div>
                        </div>
                        
                        <h6 class="mb-3">üìç Location & Context</h6>
                        <div class="mb-3">
                            <textarea class="form-control" id="locationTextarea" rows="2" placeholder="Where is the AI 'from' or what location context should they have?"></textarea>
                            <div class="form-text">Give the AI a sense of place - city, region, or cultural context that influences their perspective.</div>
                        </div>
                        
                        <h6 class="mb-3">‚úÖ Tone DO Guidelines</h6>
                        <div class="mb-3">
                            <textarea class="form-control" id="toneDoTextarea" rows="3" placeholder="What should the AI DO in terms of tone and style?"></textarea>
                            <div class="form-text">Be specific about positive tone preferences and behaviors you want the AI to exhibit.</div>
                        </div>
                        
                        <h6 class="mb-3">‚ùå Tone DON'T Guidelines</h6>
                        <div class="mb-3">
                            <textarea class="form-control" id="toneDontTextarea" rows="3" placeholder="What should the AI NOT DO in terms of tone and style?"></textarea>
                            <div class="form-text">Be specific about tone and behaviors you want the AI to avoid.</div>
                        </div>
                        
                        <h6 class="mb-3">üìù Sample Reply 1</h6>
                        <div class="mb-3">
                            <textarea class="form-control" id="sampleReply1Textarea" rows="2" placeholder="First example reply..."></textarea>
                        </div>
                        
                        <h6 class="mb-3">üìù Sample Reply 2</h6>
                        <div class="mb-3">
                            <textarea class="form-control" id="sampleReply2Textarea" rows="2" placeholder="Second example reply..."></textarea>
                        </div>
                        
                        <h6 class="mb-3">üìù Sample Reply 3</h6>
                        <div class="mb-3">
                            <textarea class="form-control" id="sampleReply3Textarea" rows="2" placeholder="Third example reply..."></textarea>
                            <div class="form-text">Give the AI concrete examples of your writing style. These sample replies demonstrate the tone and approach you want.</div>
                        </div>
                        
                        <div class="d-flex gap-2 mb-3">
                            <button type="button" class="btn btn-outline-secondary" onclick="resetAIConfig()">
                                <i class="fas fa-undo me-2"></i>Reset to Defaults
                            </button>
                            <button type="button" class="btn btn-outline-info" onclick="previewAIConfig()">
                                <i class="fas fa-eye me-2"></i>Preview
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4" id="llmPreview" style="display: none;">
                    <h6 class="mb-3">Preview</h6>
                    <div class="p-3 bg-light rounded">
                        <div class="mb-3">
                            <strong>Generated System Prompt:</strong>
                            <div class="mt-1 p-2 bg-white rounded border" id="previewSystemPrompt" style="white-space: pre-wrap; font-family: monospace; font-size: 0.9em;"></div>
                        </div>
                        <div>
                            <strong>Example User Header:</strong>
                            <div class="mt-1 p-2 bg-white rounded border" id="previewUserHeader" style="white-space: pre-wrap; font-family: monospace; font-size: 0.9em;"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveAllConfig()">Save Configuration</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Initialize theme and keyboard shortcuts
document.addEventListener('DOMContentLoaded', function() {
    // Initialize theme
    const savedTheme = localStorage.getItem('theme') || 'dark';
    setTheme(savedTheme);
    
    // Add keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Ctrl/Cmd + D: Toggle dark mode
        if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
            e.preventDefault();
            toggleTheme();
        }
        // Escape: Close any open modals
        if (e.key === 'Escape') {
            const modals = document.querySelectorAll('.modal.show');
            modals.forEach(modal => {
                const bsModal = bootstrap.Modal.getInstance(modal);
                if (bsModal) bsModal.hide();
            });
        }
        // Ctrl/Cmd + ?: Show keyboard shortcuts
        if ((e.ctrlKey || e.metaKey) && e.key === '?') {
            e.preventDefault();
            showKeyboardShortcuts();
        }
    });
});

// Theme management
function toggleTheme() {
    const currentTheme = document.documentElement.getAttribute('data-bs-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    setTheme(newTheme);
    localStorage.setItem('theme', newTheme);
}

function setTheme(theme) {
    document.documentElement.setAttribute('data-bs-theme', theme);
    const themeIcon = document.getElementById('theme-icon');
    if (theme === 'dark') {
        themeIcon.className = 'fas fa-sun';
    } else {
        themeIcon.className = 'fas fa-moon';
    }
}

// Show keyboard shortcuts modal
function showKeyboardShortcuts() {
    // Create modal if it doesn't exist
    let modal = document.getElementById('shortcutsModal');
    if (!modal) {
        modal = document.createElement('div');
        modal.id = 'shortcutsModal';
        modal.className = 'modal fade';
        modal.innerHTML = `
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="fas fa-keyboard me-2"></i>Keyboard Shortcuts
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-6">
                                <h6>Navigation</h6>
                                <ul class="list-unstyled">
                                    <li><kbd>Ctrl</kbd> + <kbd>R</kbd> - Refresh posts</li>
                                    <li><kbd>Ctrl</kbd> + <kbd>D</kbd> - Toggle dark mode</li>
                                    <li><kbd>Ctrl</kbd> + <kbd>?</kbd> - Show this help</li>
                                    <li><kbd>Esc</kbd> - Close modals</li>
                                </ul>
                            </div>
                            <div class="col-6">
                                <h6>Tips</h6>
                                <ul class="list-unstyled">
                                    <li>Click images to view full size</li>
                                    <li>Use the controls above to adjust settings</li>
                                    <li>Posts are from users you follow only (includes reposts from followed users)</li>
                                    <li>Settings are saved automatically</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
    }
    
    const bsModal = new bootstrap.Modal(modal);
    bsModal.show();
}

// Theme configuration functions
function showThemeConfig() {
    // Load current theme configuration
    loadCurrentThemeConfig();
    
    // Add event listeners for live preview
    document.getElementById('themeSelect').addEventListener('change', updateThemePreview);
    document.getElementById('toneSelect').addEventListener('change', updateThemePreview);
    document.getElementById('styleSelect').addEventListener('change', updateThemePreview);
    
    const modal = new bootstrap.Modal(document.getElementById('themeConfigModal'));
    modal.show();
}

function loadCurrentThemeConfig() {
    // Load from localStorage or use defaults
    const currentConfig = JSON.parse(localStorage.getItem('aiThemeConfig') || '{"theme": "cycling", "tone": "enthusiastic", "style": "conversational"}');
    
    document.getElementById('themeSelect').value = currentConfig.theme;
    document.getElementById('toneSelect').value = currentConfig.tone;
    document.getElementById('styleSelect').value = currentConfig.style;
    
    updateCurrentConfigDisplay(currentConfig);
    updateThemePreview();
}

function updateCurrentConfigDisplay(config) {
    const themeLabels = {
        'cycling': 'Cycling',
        'environment': 'Environment',
        'technology': 'Technology',
        'community': 'Community'
    };
    
    const toneLabels = {
        'enthusiastic': 'Enthusiastic',
        'professional': 'Professional',
        'casual': 'Casual',
        'humorous': 'Humorous'
    };
    
    const styleLabels = {
        'conversational': 'Conversational',
        'formal': 'Formal',
        'brief': 'Brief'
    };
    
    document.getElementById('currentTheme').textContent = themeLabels[config.theme] || 'Cycling';
    document.getElementById('currentTone').textContent = toneLabels[config.tone] || 'Enthusiastic';
    document.getElementById('currentStyle').textContent = styleLabels[config.style] || 'Conversational';
}

function updateThemePreview() {
    const theme = document.getElementById('themeSelect').value;
    const tone = document.getElementById('toneSelect').value;
    const style = document.getElementById('styleSelect').value;
    
    const previews = {
        'cycling': {
            'enthusiastic': 'This is exactly the kind of cycling infrastructure we need! Safe, accessible design benefits everyone in our community üö≤‚ôø',
            'professional': 'This cycling infrastructure demonstrates excellent urban planning principles that prioritize safety and accessibility for all users.',
            'casual': 'Nice bike infrastructure! This is how we make cities more livable for everyone üö¥‚Äç‚ôÄÔ∏è',
            'humorous': 'Finally, bike lanes that don\'t disappear into thin air! This is infrastructure that actually works üö≤‚ú®'
        },
        'environment': {
            'enthusiastic': 'This is exactly the kind of environmental progress we need! Every step toward sustainability makes a difference üå±',
            'professional': 'This initiative demonstrates effective environmental stewardship and sustainable practices that benefit our ecosystem.',
            'casual': 'Love seeing environmental action in practice! This is how we protect our planet üåç',
            'humorous': 'Mother Nature is definitely giving this a thumbs up! Great environmental initiative üåøüëç'
        },
        'technology': {
            'enthusiastic': 'This is exactly the kind of innovation we need! Technology that makes life better for everyone üíª',
            'professional': 'This technological solution demonstrates effective implementation of digital tools that enhance user experience.',
            'casual': 'Cool tech! This is how innovation should work - making things better for people ü§ñ',
            'humorous': 'Finally, technology that doesn\'t make you want to throw your computer out the window! üñ•Ô∏è‚ú®'
        },
        'community': {
            'enthusiastic': 'This is exactly the kind of community spirit we need! Connection and support make neighborhoods stronger ü§ù',
            'professional': 'This community initiative demonstrates effective social engagement and neighborhood development strategies.',
            'casual': 'Love seeing community building in action! This is how neighborhoods thrive üèòÔ∏è',
            'humorous': 'This is what happens when neighbors actually talk to each other - magic! üè†‚ú®'
        }
    };
    
    const preview = previews[theme]?.[tone] || 'This is a great example of positive community action!';
    document.getElementById('themePreview').innerHTML = `<em>"${preview}"</em>`;
}

function saveThemeConfig() {
    const config = {
        theme: document.getElementById('themeSelect').value,
        tone: document.getElementById('toneSelect').value,
        style: document.getElementById('styleSelect').value
    };
    
    // Save to localStorage
    localStorage.setItem('aiThemeConfig', JSON.stringify(config));
    
    // Update current config display
    updateCurrentConfigDisplay(config);
    
    // Close modal
    const modal = bootstrap.Modal.getInstance(document.getElementById('themeConfigModal'));
    modal.hide();
    
    // Show success message
    showSuccessMessage('AI theme configuration saved successfully!');
}

function showSuccessMessage(message) {
    const successAlert = document.getElementById('success-alert');
    const successMessage = document.getElementById('success-message');
    successMessage.textContent = message;
    successAlert.style.display = 'block';
    
    setTimeout(() => {
        successAlert.style.display = 'none';
    }, 3000);
}

// AI Configuration functions
function loadAIConfig() {
    fetch('/api/ai-config')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('personaTextarea').value = data.settings.persona || '';
                document.getElementById('locationTextarea').value = data.settings.location || '';
                document.getElementById('toneDoTextarea').value = data.settings.tone_do || '';
                document.getElementById('toneDontTextarea').value = data.settings.tone_dont || '';
                document.getElementById('sampleReply1Textarea').value = data.settings.sample_reply_1 || '';
                document.getElementById('sampleReply2Textarea').value = data.settings.sample_reply_2 || '';
                document.getElementById('sampleReply3Textarea').value = data.settings.sample_reply_3 || '';
            } else {
                console.error('Failed to load AI config:', data.error);
                showErrorMessage('Failed to load AI configuration');
            }
        })
        .catch(error => {
            console.error('Error loading AI config:', error);
            showErrorMessage('Error loading AI configuration');
        });
}

function saveAIConfig() {
    const persona = document.getElementById('personaTextarea').value;
    const location = document.getElementById('locationTextarea').value;
    const toneDo = document.getElementById('toneDoTextarea').value;
    const toneDont = document.getElementById('toneDontTextarea').value;
    const sampleReply1 = document.getElementById('sampleReply1Textarea').value;
    const sampleReply2 = document.getElementById('sampleReply2Textarea').value;
    const sampleReply3 = document.getElementById('sampleReply3Textarea').value;
    
    const settings = {
        persona: persona,
        location: location,
        tone_do: toneDo,
        tone_dont: toneDont,
        sample_reply_1: sampleReply1,
        sample_reply_2: sampleReply2,
        sample_reply_3: sampleReply3
    };
    
    fetch('/api/ai-config', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(settings)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showSuccessMessage('AI configuration saved successfully!');
        } else {
            console.error('Failed to save AI config:', data.error);
            showErrorMessage('Failed to save AI configuration');
        }
    })
    .catch(error => {
        console.error('Error saving AI config:', error);
        showErrorMessage('Error saving AI configuration');
    });
}

function resetAIConfig() {
    if (confirm('Are you sure you want to reset AI configuration to defaults? This will overwrite your current settings.')) {
        fetch('/api/ai-config/reset', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('personaTextarea').value = data.settings.persona || '';
                document.getElementById('locationTextarea').value = data.settings.location || '';
                document.getElementById('toneDoTextarea').value = data.settings.tone_do || '';
                document.getElementById('toneDontTextarea').value = data.settings.tone_dont || '';
                document.getElementById('sampleReply1Textarea').value = data.settings.sample_reply_1 || '';
                document.getElementById('sampleReply2Textarea').value = data.settings.sample_reply_2 || '';
                document.getElementById('sampleReply3Textarea').value = data.settings.sample_reply_3 || '';
                showSuccessMessage('AI configuration reset to defaults!');
            } else {
                console.error('Failed to reset AI config:', data.error);
                showErrorMessage('Failed to reset AI configuration');
            }
        })
        .catch(error => {
            console.error('Error resetting AI config:', error);
            showErrorMessage('Error resetting AI configuration');
        });
    }
}

function previewAIConfig() {
    const persona = document.getElementById('personaTextarea').value;
    const location = document.getElementById('locationTextarea').value;
    const toneDo = document.getElementById('toneDoTextarea').value;
    const toneDont = document.getElementById('toneDontTextarea').value;
    const sampleReply1 = document.getElementById('sampleReply1Textarea').value;
    const sampleReply2 = document.getElementById('sampleReply2Textarea').value;
    const sampleReply3 = document.getElementById('sampleReply3Textarea').value;
    
    // Build system prompt preview
    const promptParts = [];
    
    if (persona.trim()) {
        promptParts.push(`PERSONA: ${persona.trim()}`);
    }
    
    if (location.trim()) {
        promptParts.push(`LOCATION: ${location.trim()}`);
    }
    
    // Build tone guidelines
    const toneGuidelines = [];
    if (toneDo.trim()) {
        toneGuidelines.push(`DO: ${toneDo.trim()}`);
    }
    if (toneDont.trim()) {
        toneGuidelines.push(`DON'T: ${toneDont.trim()}`);
    }
    
    if (toneGuidelines.length > 0) {
        promptParts.push(`TONE GUIDELINES:\n${toneGuidelines.join('\n\n')}`);
    }
    
    // Build sample replies
    const sampleReplies = [];
    if (sampleReply1.trim()) sampleReplies.push(sampleReply1.trim());
    if (sampleReply2.trim()) sampleReplies.push(sampleReply2.trim());
    if (sampleReply3.trim()) sampleReplies.push(sampleReply3.trim());
    
    if (sampleReplies.length > 0) {
        promptParts.push(`WRITING STYLE REFERENCE: Here are some approved sample replies that demonstrate the desired tone and style:\n${sampleReplies.join('\n\n')}`);
    }
    
    promptParts.push("TASK: Given a Bluesky post (caption) and its images, write a short, funny, topical reply. Keep it under 220 characters unless absolutely necessary. Avoid hashtags unless they enhance the joke.");
    
    const systemPrompt = promptParts.join("\n\n");
    document.getElementById('previewSystemPrompt').textContent = systemPrompt;
    
    // Create example user header
    const exampleUserHeader = `Bluesky post caption: Check out this amazing bike lane!

Accessibility alt texts:
A wide bike lane with clear markings and safety barriers

There are 2 image(s). Analyze the images and the text together and craft one funny, hyper-relevant reply.`;
    
    document.getElementById('previewUserHeader').textContent = exampleUserHeader;
    
    // Show preview section
    document.getElementById('llmPreview').style.display = 'block';
}

function saveAllConfig() {
    // Save AI configuration
    saveAIConfig();
    
    // Close modal
    const modal = bootstrap.Modal.getInstance(document.getElementById('themeConfigModal'));
    modal.hide();
}

function showErrorMessage(message) {
    // Create or update error alert
    let errorAlert = document.getElementById('error-alert');
    if (!errorAlert) {
        errorAlert = document.createElement('div');
        errorAlert.id = 'error-alert';
        errorAlert.className = 'alert alert-danger alert-dismissible fade show position-fixed';
        errorAlert.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
        errorAlert.innerHTML = `
            <span id="error-message"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        document.body.appendChild(errorAlert);
    }
    
    const errorMessage = document.getElementById('error-message');
    errorMessage.textContent = message;
    errorAlert.style.display = 'block';
    
    setTimeout(() => {
        errorAlert.style.display = 'none';
    }, 5000);
}

// Update showThemeConfig to load AI configuration
const originalShowThemeConfig = showThemeConfig;
showThemeConfig = function() {
    // Load AI configuration
    loadAIConfig();
    
    const modal = new bootstrap.Modal(document.getElementById('themeConfigModal'));
    modal.show();
};

// Make functions globally available
window.showThemeConfig = showThemeConfig;
window.saveThemeConfig = saveThemeConfig;
window.saveAllConfig = saveAllConfig;
window.loadAIConfig = loadAIConfig;
window.saveAIConfig = saveAIConfig;
window.resetAIConfig = resetAIConfig;
window.previewAIConfig = previewAIConfig;
</script>
{% endblock %}
